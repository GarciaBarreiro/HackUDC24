---
import Layout from '~/layouts/PageLayout.astro';

import Headline from '~/components/blog/Headline.astro';

import Form from '~/components/ui/Form.astro';

const metadata = {
  title: 'Register',
}
---

<Layout metadata={metadata}>

  <Headline
    title="Register"
    subtitle="or don't"
  />

  <div class="flex flex-col max-w-xl mx-auto rounded-lg backdrop-blur border border-gray-200 dark:border-gray-700 bg-white dark:bg-slate-900 shadow p-4 sm:p-6 lg:p-8 w-full mb-8">
    <Form
      action={'http://localhost:5000'}
      inputs={[
        {
          type: 'text',
          name: 'username',
          label: 'Username',
        },
        {
          type: 'text',
          name: 'mail',
          label: 'Mail',
        },
        {
          type: 'password',
          name: 'password',
          label: 'Password',
        }
      ]}
      button={[ // TODO: onclick: script
        {
          type: 'submit',
          text: 'Register',
          variant: 'primary',
        },
        {
          text: '<span class="text-slate-500">Already have an account?</span>&nbsp;Log In',
          variant: 'secondary',
          type: 'link',
          href: 'login',
        },
      ]}
    />
  </div>

</Layout>

<script>
  const form = document.querySelector("#form");

  async function sendData() {
    const formData = new FormData(form);
    var object = {};
    formData.forEach((value, key) => object[key] = value);
    var json = JSON.stringify(object);

    try {
      const response = await fetch("http://localhost:5000/auth/register", {
        method: "POST",
        headers: new Headers({'content-type': 'application/json'}),
        body: json,
      });
      var rpjson = await response.json();
      if (rpjson.message === 'User successfully registered') {
        window.location.href = "dashboard";
      }
    } catch (e) {
      console.error(e);
    }
  }

  form.addEventListener("submit", (event) => {
    event.preventDefault();
    sendData();
  });
</script>
